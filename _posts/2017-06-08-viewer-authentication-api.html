---
layout: post
title: Viewer Authentication API
weight: 3
category: channel-api
categoryItemType: documentation
categoryItemIsShown: 1
categoryItemWidth: 6
categoryItemDescription: Viewer Authentication API lets you implement custom authentication for authenticating viewers of live and recorded videos served by IBM Cloud Video.
categoryItemLabel: Read the documentation
---
<article data-sidenav="sidenav">
    <script>
      (function () {
        var lightboxCssTag = document.createElement('link');
        lightboxCssTag.href = '/css/lightbox.css';
        lightboxCssTag.type = 'text/css';
        lightboxCssTag.rel = 'stylesheet';
        var lightboxScriptTag = document.createElement('script');
        lightboxScriptTag.src = '/js/lightbox.min.js';
        lightboxScriptTag.defer = true;
        lightboxScriptTag.addEventListener('load', function () {
          var lightbox = new Lightbox();
          lightbox.load();
        });
        document.head.appendChild(lightboxCssTag);
        document.head.appendChild(lightboxScriptTag);
      })();
    </script>
    <section>

        <h2>Introduction</h2>

        <p>Viewer Authentication API lets you implement custom authentication for authenticating viewers of live and recorded videos served by IBM Cloud Video.</p>

        <p>You need the following before you start implementing viewer authentication:</p>

        <ul>
            <li><strong>Channel</strong>, which you can create on the <a href="https://www.ustream.tv/dashboard/manage-show" target="_blank">Your channels page</a> of your IBM Cloud Video dashboard</li>
            <li><strong>Client id</strong>, which you can obtain on the <a href="https://www.ustream.tv/dashboard/integrations/api-access" target="_blank">API/SDK access page</a> of your IBM Cloud Video dashboard</li>
            <li><strong>Token</strong>, which you can obtain through the IBM Cloud Video <a href="http://developers.ustream.tv/channel-api/getting-started.html#oauth2-authorization-server-endpoints_6" target="_blank">authorization endpoint</a></li>
            <li><strong>Secret key</strong>, a string that will be used to create the hash in the authentication response your service passes to the IBM Cloud Video player. This secret key needs to be provided by you.</li>
        </ul>

    </section>

    <section>

        <h2>Viewer authentication flow</h2>
        <p>To implement the viewer authentication flow you need to create an application that includes the following:</p>
        <ul>
            <li>Screens your viewers need to go through to authenticate</li>
            <li>Backend code that validates these authentication requests</li>
            <li>Process to pass the authentication response to the IBM Cloud Video player</li>
        </ul>

        <a class="jslghtbx-thmb" href="/images/advanced-auth-2x.png" target="_blank" data-jslghtbx="/images/advanced-auth-2x.png">
            <img class="no-border" src="/images/advanced-auth.png" srcset="/images/advanced-auth.png 1x, /images/advanced-auth-2x.png 2x" alt="Viewer authentication API flowchart">
        </a>

        <a class="jslghtbx-thmb" href="/images/hashlock-example-2x.png" target="_blank" data-jslghtbx="/images/hashlock-example-2x.png">
            <img class="no-border" src="/images/hashlock-example.png" srcset="/images/hashlock-example.png 1x, /images/hashlock-example-2x.png 2x" alt="Viewer authentication API example flow">
        </a>

        <ol>
            <li>When the viewer clicks the log in button in the IBM Cloud Video player the entry point of your custom authentication flow is displayed in an iframe in the player.</li>
            <li>When the authentication is completed your service passes an authentication response to the player.</li>
            <li>If the authentication was successful, the player passes the authentication response to IBM Cloud Video infrastructure in a validation request.</li>
            <li>The IBM Cloud Video infrastructure validates the authentication response received from your service and passes a validation response to the player. If the response is positive, the viewer can start watching the video.</li>
        </ol>

    </section>

    <section>

        <h2>Setting up viewer authentication</h2>

        <table class="table fill-bg-light1 table-chromeless">
            <tr>
                <td class="verb">PUT</td>
                <td><a>https://api.ustream.tv/channels/CHANNEL_ID/locks/hash/advanced.FORMAT</a> (format can be json or xml)</td>
            </tr>
        </table>

        <h6>Parameters</h6>

        <table class="table responsive">
            <tr>
                <th>parameter</th>
                <th>type</th>
                <th>importance</th>
                <th width="100%">Description</th>
            </tr>
            <tr>
                <td><strong>url</strong></td>
                <td>string</td>
                <td>REQUIRED</td>
                <td>URL of the authentication flow entry point</td>
            </tr>
            <tr>
                <td><strong>secret</strong></td>
                <td>string</td>
                <td>REQUIRED</td>
                <td>Secret key</td>
            </tr>
        </table>

        <h6>Response</h6>

        <p>HTTP response codes returned when the action is successful:</p>

        <table class="table responsive">
            <tr>
                <th>HTTP response code</th>
                <th width="100%">Description</th>
            </tr>
            <tr>
                <td>201 Created</td>
                <td>Viewer authentication has been set up on the channel with the new hash.</td>
            </tr>
            <tr>
                <td>204 No Content</td>
                <td>Viewer authentication has been set up on the channel by updating the existing hash with the new one.</td>
            </tr>
        </table>

        <p>Specific error codes returned when the action failed:</p>

        <table class="table responsive">
            <tr>
                <th>error value</th>
                <th>HTTP response code</th>
                <th width="100%">Description</th>
            </tr>
            <tr>
                <td>invalid_request</td>
                <td>400 Bad Request</td>
                <td>One or more required parameters are missing (secret, url).</td>
            </tr>
            <tr>
                <td>invalid_type</td>
                <td>400 Bad Request</td>
                <td>The URL is invalid.</td>
            </tr>
            <tr>
                <td>lack_of_ownership</td>
                <td>403 Forbidden</td>
                <td>The api user is not allowed to manage the given channel</td>
            </tr>
            <tr>
                <td>not_found</td>
                <td>404 Not found</td>
                <td>Channel not found</td>
            </tr>
        </table>

    </section>

    <section>

        <h2>Implementing the authentication response</h2>

        <p>If the authentication was successful your service has to pass an authentication response to the player. The authentication response must be a JSON encoded array which contains the following:</p>

        <ul>
            <li>list of parameters that have been hashed</li>
            <li>the MD5 hash of the string that has been created by concatenating the parameters and the shared secret key with pipe "|" characters</li>
        </ul>

        <p>Example script in PHP for creating the authentication response when the authentication was successful</p>

        <pre><code class="php">
// We create the array of paramters.
// The parameters can be anything.
$userData = [
    "username" => $_GET["user"],
    "someString" => "someValue"
];

// We create the hash by hashing
// the parameters array contents and
// the secret key
// concatenated together with a pipe character.
$hash = md5(implode('|', $userData) . '|' . $SHARED_SECRET_KEY);

// We put the array of parameters and the hash into the response.
$response = array_chunk(
    array_merge($userData, ["hash" => $hash]),
    1,
    true
);

// We encode the response into JSON format.
$json = json_encode($response);
        </code></pre>

        <div class="panel">The order of the parameters should match their order in the array when creating the hash.</div>

        <p>To pass the response to the player your service has to redirect the page to the IBM Cloud Video return URL with passing the response in JSON format as a get parameter. You can test the API response at the <a href="/channel-api/hash-authentication-test.html">Hash Authentication Test</a> page.</p>

        <pre><code>https://www.ustream.tv/embed/hashlock/pass?hash=RESPONSE_IN_JSON_FORMAT</code></pre>

        <p>If the authentication failed your service has to pass a "false" string as the authentication response to the player.</p>

        <pre><code>https://www.ustream.tv/embed/hashlock/pass?hash=false</code></pre>

    </section>

    <section>

        <h2>Managing viewer authentication settings</h2>

        <h3>Getting viewer authentication settings</h3>

        <table class="table fill-bg-light1 table-chromeless">
            <tr>
                <td class="verb">GET</td>
                <td><a>https://api.ustream.tv/channels/CHANNEL_ID/locks/hash.FORMAT</a> (format can be json or xml)</td>
            </tr>
        </table>

        <h6>Parameters</h6>

        <p>This request has no parameters.</p>

        <h6>Response</h6>

        <p>On success, key-value pairs are returned under a "hashlock" key.</p>

        <p>Example:</p>

        <pre><code class="json">
{
    "hashlock": {
        "type": "advanced",
        "url": "https://align.ustream.tv/auth/123",
        "message": null,
        "button_caption": null,
        "popup_width": "0",
        "popup_height": "0"
    }
}
        </code></pre>

        <p>Specific error codes returned when the action failed:</p>

        <table class="table responsive">
            <tr>
                <th>error value</th>
                <th>HTTP response code</th>
                <th width="100%">Description</th>
            </tr>
            <tr>
                <td>lack_of_ownership</td>
                <td>403 Forbidden</td>
                <td>The api user is not allowed to manage the given channel</td>
            </tr>
            <tr>
                <td>not_found</td>
                <td>404 Not found</td>
                <td>Channel not found</td>
            </tr>
        </table>

        <h3>Removing viewer authentication</h3>

        <table class="table fill-bg-light1 table-chromeless">
            <tr>
                <td class="verb">DELETE</td>
                <td><a>https://api.ustream.tv/channels/CHANNEL_ID/locks/hash.FORMAT</a> (format can be json or xml)</td>
            </tr>
        </table>

        <h6>Parameters</h6>

        <p>This request has no parameters.</p>

        <h6>Response</h6>

        <p>On success the 200 OK HTTP response code is returned.</p>

        <p>Specific error codes returned when the action failed:</p>

        <table class="table responsive">
            <tr>
                <th>error value</th>
                <th>HTTP response code</th>
                <th width="100%">Description</th>
            </tr>
            <tr>
                <td>lack_of_ownership</td>
                <td>403 Forbidden</td>
                <td>The api user is not allowed to manage the given channel</td>
            </tr>
            <tr>
                <td>not_found</td>
                <td>404 Not found</td>
                <td>Channel not found</td>
            </tr>
        </table>

    </section>

    <section>

        <h2>Hash lifetime and expiration</h2>

        <p>Once is successfully validated by IBM Cloud Video, the player will store the hash in the end user’s browser. This lets the viewer watch the video when returning to the page without having authenticate again.</p>

        <p>You can specify an expiration date for the hash. When the viewer returns to the page after the expiration date, she has to authenticate again.</p>

        <p>Expiration date has to be</p>
        <ul>
            <li>Specified in UNIX timestamp format</li>
            <li>Part of the hash by concatenating it to the rest of the parameters</li>
            <li>Included in the response object as “hashExpire”.</li>
            <li>JSON encoded as part of the response</li>
        </ul>

        <p>Example script in PHP for specifying hash expiration date</p>

        <pre><code class="php">
// We specify an expiration date as a UNIX timestamp
// which is valid for one hour.
$expiration = time()+3600;

// We concatenate it to the rest of the paramteres when creating the hash.
$hash = md5(implode('|', $userData).'|'.$expiration.'|'.$SHARED_SECRET_KEY);

// We inculde it in the response.
$response = array_merge($userData, ["hashExpire" => $expiration, "hash" => $hash]);

// We encode the output into JSON format.
$json = json_encode($response);
        </code></pre>

        <p>When validating the authentication response the IBM Cloud Video infrastructure checks</p>
        <ul>
            <li>If the expiration is a past date</li>
            <li>If the expiration was hashed properly</li>
        </ul>

        <p>This way we can make sure that the expiration date comes from you and it has not been tampered on the client side.</p>

    </section>

</article>
